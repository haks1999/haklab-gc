<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Serial &amp; Throughput Garbage Collection</title>

    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/full-slider.css" rel="stylesheet">
    
    <style type="text/css">
    	.top-buffer { margin-top:100px; }
    	.heap {
    		width:375px;border-radius:5px;background-color:#555;padding:10px;
    	}
    	.heap .young{
    		height:150px;
    	}
    	.heap .young .space, .heap .old{
    		border-radius:5px;
    	}
    	.heap .young .space{
    		height:145px;float:left;
    	}
    	.heap .young .eden {
    		width:180px;background-color:#5bc0de;
    	}
    	.heap .young .s1 {
    		width:75px;background-color:#5bc0de;margin-left:12px;
    	}
    	.heap .young .s2 {
    		width:75px;background-color:#5bc0de;margin-left:12px;
    	}
    	.heap .old {
    		height:145px;background-color:#428bca;
    	}
    	.heap .object{
    		width:30px;height:30px;background-color:#f0ad4e;margin-left:5px;margin-top:5px;float:left;border-radius:10px;border:3px solid #555;
    	}
    	.heap .object.notuse{
    		border-style:dotted; font-size: 15px;font-weight: bold;color:#555;line-height:0px;padding: 5px 2px; 
    	}
    	.heap .object.notuse:before{
    		content:"x";
    	}
    	.heap .young .object.copying{
    		background-color:#5bc0de;border-style:dotted;
    	}
    	.heap .old .object.copying{
    		background-color:#428bca;border-style:dotted;
    	}
    	.heap .object.empty{
    		display:none;
    	}
    	.heap .h-label{
    		color:#eee;font-weight:bold;
    	}
    	.heap .h-label span{
    		text-align:center;display:inline-block;
    	}
    	.heap .h-label div{
    		text-align:center;
    	}
    	.heap .h-label .eden {
    		width:180px;
    	}
    	.heap .h-label .s1 {
    		width:70px;margin-left:10px;
    	}
    	.heap .h-label .s2 {
    		width:70px;margin-left:10px;
    	}

   		footer{
   			padding-top: 40px;padding-bottom: 40px;margin-top: 100px;color: #777;text-align: center;border-top: 1px solid #e5e5e5;
   		}
   	
   	.bs-callout+.bs-callout {
margin-top: -5px;
}

	
   		.bs-callout-info {
border-left-color: #5bc0de;
}
.bs-callout {
padding: 20px;
margin: 20px 0;
border: 1px solid #eee;
border-left-width: 5px;
border-radius: 3px;
}



    </style>

</head>

<body>

    <nav class="navbar navbar-fixed-top navbar-inverse" role="navigation">
    
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.php">Start Bootstrap</a>
            </div>

            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="#about">About</a>
                    </li>
                    <li><a href="#services">Services</a>
                    </li>
                    <li><a href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="myCarousel" class="carousel slide">
        <ol class="carousel-indicators">
            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            <li data-target="#myCarousel" data-slide-to="1"></li>
            <li data-target="#myCarousel" data-slide-to="2"></li>
            <li data-target="#myCarousel" data-slide-to="3"></li>
            <li data-target="#myCarousel" data-slide-to="4"></li>
            <li data-target="#myCarousel" data-slide-to="5"></li>
            <li data-target="#myCarousel" data-slide-to="6"></li>
            <li data-target="#myCarousel" data-slide-to="7"></li>
        </ol>

        <div class="carousel-inner">
        
            <div id="initial-heap" class="item active">
            
                <div class="container top-buffer">

                	<div class="row section">
                		<div class="col-md-1"></div>
                		
                		<div class="figure col-md-5">
                			<div class="heap">
                				<div class="h-label">
                					<span class="eden">Eden</span>
                					<span class="s1">S1</span>
                					<span class="s2">S2</span>
                				</div>
                				<div class="young">
                					<div class="space eden">
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                					</div>
                					<div class="space s1">
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                					</div>
                					<div class="space s2">
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                						<div class="object empty"></div>
                					</div>
                				</div>
                				<hr/>
                				<div class="h-label">
                					<div>Old Generation</div>
                				</div>
                				<div class="old">
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                					<div class="object empty"></div>
                				</div>
                			</div>
                		</div>
                		<div class="col-md-4">
                			<div class="btn-group btn-group-sm">
                				<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></button>
        						<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button>
							</div>
                			<h3>The Layout of the heap</h3>
							<ul>
								<li><strong>The eden</strong> This is where most new objects are allocated (not all, as large objects may be allocated directly into the old generation). The eden is almost always empty after a minor garbage collection. </li>
								<li><strong>The two survivor spaces (S1, S2)</strong> These hold objects that have survived at least one minor garbage collection.</li>
								<li><strong>The Old generation</strong> Objects that are longer-lived are eventually promoted, or tenured, to the old generation.</li>
							</ul>
							<div class="well well-sm">
      							The Application is not running.
    						</div>
                		</div>
                		
                	</div>
				</div>
            </div>
            
            <div id="eden-allocate" class="item">
            	<div class="container top-buffer">
                	<div class="row section">
                		<div class="col-md-1"></div>
                		<div class="figure col-md-5">
                		</div>
                		<div class="col-md-4">
                			<div class="btn-group btn-group-sm">
                				<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></button>
								<button type="button" class="btn btn-default" onclick="initializeHeapLayout();edenAllocate();">
  									<span class="glyphicon glyphicon-repeat"></span>
								</button>
        						<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button>
							</div>
                			<h3>Eden Allocation
							</h3>
							<ul>
								<li>Allocations into the eden by using what’s referred to as "the bump-the-pointer technique"</li>
								<li>The end of the last allocated object is tracked, and when a new allocation request needs to be satisfied, the allocator needs only to check whether it will fit between top and the end of the eden. If it does, top is bumped to the end of the newly allocated object</li>
							</ul>
							<div class="well well-sm">
      							The Application is running.
    						</div>
                			
                		</div>
                	</div>
				</div>
			</div>
			
            <div id="minor-gc-01" class="item">
            	<div class="container top-buffer">
                	<div class="row section">
                		<div class="col-md-1"></div>
                		<div class="figure col-md-5">
                		</div>
                		<div class="col-md-4">
                			<div class="btn-group btn-group-sm">
                				<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></button>
								<button type="button" class="btn btn-default" onclick="initializeHeapLayout();minorGC01();">
  									<span class="glyphicon glyphicon-repeat"></span>
								</button>
        						<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button>
							</div>
                			<h3>Minor Garbage Collection 01
							</h3>
							<ol>
								<li>Objects that have been found to be garbage are marked with a X.</li>
								<li>Live objects in the eden that survive the collection are copied to the unused survivor space(S1).</li>
								<li>Finally the eden is entirely empty</li>
							</ol>
							<div class="well well-sm">
      							The Application is stopped for garbage collection.
    						</div>
                		</div>
                	</div>
				</div>
            </div>
            
            <div id="minor-gc-02" class="item">
            	<div class="container top-buffer">
                	<div class="row section">
                		<div class="col-md-1"></div>
                		<div class="figure col-md-5">
                		</div>
                		<div class="col-md-4">
                			<div class="btn-group btn-group-sm">
                				<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></button>
								<button type="button" class="btn btn-default" onclick="initializeHeapLayout();minorGC02();">
  									<span class="glyphicon glyphicon-repeat"></span>
								</button>
        						<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button>
							</div>
                			<h3>Minor Garbage Collection 02
							</h3>
							<ol>
								<li>Objects that have been found in Eden and Survivor(S1) to be garbage are marked with a X.</li>
								<li>Live objects in the eden that survive the collection are copied to the unused survivor space(S2).</li>
								<li>Live objects in the survivor space that is in use, which will be given another chance to be reclaimed in the young generation, are also copied to the unused survivor space(S2).</li>
								<li>At the end of the minor garbage collection, the two survivor spaces swap roles.</li>
								<li>Finally the eden is entirely empty and only one survivor space is in use.</li>
							</ol>
							<div class="well well-sm">
      							The Application is stopped for garbage collection.
    						</div>
                			
                		</div>
                	</div>
				</div>
            </div>
            
            <div id="minor-gc-03" class="item">
            	<div class="container top-buffer">
                	<div class="row section">
                		<div class="col-md-1"></div>
                		<div class="figure col-md-5">
                		</div>
                		<div class="col-md-4">
                			<div class="btn-group btn-group-sm">
                				<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></button>
								<button type="button" class="btn btn-default" onclick="initializeHeapLayout();minorGC03();">
  									<span class="glyphicon glyphicon-repeat"></span>
								</button>
        						<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button>
							</div>
                			<h3>Minor Garbage Collection 03
							</h3>
							<ul>
								<li>Same as before. just for checking swapped survivor spaces.</li>
							</ul>
							<div class="well well-sm">
      							The Application is stopped for garbage collection.
    						</div>
                			
                		</div>
                	</div>
				</div>
            </div>
            
            <div id="minor-gc-04" class="item">
            	<div class="container top-buffer">
                	<div class="row section">
                		<div class="col-md-1"></div>
                		<div class="figure col-md-5">
                		</div>
                		<div class="col-md-4">
                			<div class="btn-group btn-group-sm">
                				<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></button>
								<button type="button" class="btn btn-default" onclick="initializeHeapLayout();minorGC04();">
  									<span class="glyphicon glyphicon-repeat"></span>
								</button>
        						<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button>
							</div>
                			<h3>Minor Garbage Collection 04
							</h3>
							<ul>
								<li>Live objects in the survivor space that is in use, that are deemed “old enough”, are promoted to the old generation.</li>
								<li>During a minor garbage collection, there is no guarantee that the allocating survivor space will always be large enough to accommodate the surviving objects from both the eden and the other survivor space. If it overflows, the rest of the objects that need to be evacuated will be moved to the old generation. This is referred to as "premature promotion".</li>
							</ul>
							<div class="well well-sm">
      							The Application is stopped for garbage collection.
    						</div>
                			
                		</div>
                	</div>
				</div>
            </div>
            
            <div id="full-gc" class="item">
            	<div class="container top-buffer">
                	<div class="row section">
                		<div class="col-md-1"></div>
                		<div class="figure col-md-5">
                		</div>
                		<div class="col-md-4">
                			<div class="btn-group btn-group-sm">
                				<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></button>
								<button type="button" class="btn btn-default" onclick="initializeHeapLayout();fullGC();">
  									<span class="glyphicon glyphicon-repeat"></span>
								</button>
        						<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button>
							</div>
                			<h3>Full Garbage Collection
							</h3>
							<p>mark-compact garbage collector</p>
							<ol>
								<li>The mark-compact garbage collector first identifies which objects are still live in the old generation.</li>
								<li>Then the collector slides live objects toward the beginning of the heap, leaving any free space in a single contiguous chunk at the end of the heap.</li>
								<li>Future allocations into the old generation to use the fast bump-the-pointer technique.</li>
							</ol>
							<div class="well well-sm">
      							The Application is stopped for garbage collection.
    						</div>
                			
                		</div>
                	</div>
				</div>
            </div>
            
            <div id="minor-gc-05" class="item">
            	<div class="container top-buffer">
                	<div class="row section">
                		<div class="col-md-1"></div>
                		<div class="figure col-md-5">
                		</div>
                		<div class="col-md-4">
                			<div class="btn-group btn-group-sm">
                				<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></button>
								<button type="button" class="btn btn-default" onclick="initializeHeapLayout();minorGC05();">
  									<span class="glyphicon glyphicon-repeat"></span>
								</button>
        						<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></button>
							</div>
                			<h3>Minor Garbage Collection 05
							</h3>
							<p>This is basic cycle of Serial Garbage collection.(same as Parallel Garbage collection but multithreaded collectors)</p>
							<div class="well well-sm">
      							The Application is stopped for garbage collection.
    						</div>
                			
                		</div>
                	</div>
				</div>
            </div>
            
        </div>

        <!-- Controls -->
       <a class="left carousel-control" href="#myCarousel" data-slide="prev">
            <span class="icon-prev"></span>
        </a>
        <a class="right carousel-control" href="#myCarousel" data-slide="next">
            <span class="icon-next"></span>
        </a>
    </div>


    <footer>
    	<div class="container">
        	<p>Created by <a href="mailto:haks1999@gmail.com">haks1999@gmail.com</a></p>
        	<p> View on gitbub <a href="https://github.com/haks1999/haklab-gc">hakslab-gc</a></p>
		</div>
	</footer>


    <!-- JavaScript -->
   	<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script src="js/bootstrap.js"></script>

    <!-- Script to Activate the Carousel -->
    <script>
    $(function() {
    	
    	$(".carousel").carousel({
            interval : false
        });
    	
    	
    	$(".carousel-inner button span.glyphicon-chevron-left").click(function(){
    		$(".carousel").carousel("prev");	
    	});
    	
    	$(".carousel-inner button span.glyphicon-chevron-right").click(function(){
    		$(".carousel").carousel("next");	
    	});
    	
		
    	
    	initializeHeapLayout();
    	// after change
    	$('.carousel').on('slid.bs.carousel', function () {
            var activeItemId = $(".carousel-inner div.active").attr("id");
            if( activeItemId == "initial-heap"){
            	initializeHeapLayout();
            }else if( activeItemId == "eden-allocate" ){
            	//$("#eden-allocate .eden .object").removeClass("empty").addClass("empty").css("display","");
            	initializeHeapLayout({"eden-allocate":true});
            	edenAllocate();
            	
            }else if( activeItemId == "minor-gc-01" ){
            	initializeHeapLayout({"minor-gc-01":true});
            	minorGC01();
            	
            }else if( activeItemId == "minor-gc-02" ){
            	initializeHeapLayout({"minor-gc-02":true});
            	minorGC02();
            	
            }else if( activeItemId == "minor-gc-03" ){
            	initializeHeapLayout({"minor-gc-03":true});
            	minorGC03();
            	
            }else if( activeItemId == "minor-gc-04" ){
            	initializeHeapLayout({"minor-gc-04":true});            	
            	minorGC04();
            	
            }else if( activeItemId == "full-gc"){
            	initializeHeapLayout({"full-gc":true});
            	fullGC();
            	
            }else if( activeItemId == "minor-gc-05"){
            	initializeHeapLayout({"minor-gc-05":true});            	
            	minorGC05();
            }
        }); 
    	
	});
    
    	
    /*
    $('.carousel').carousel({
        interval: 5000 //changes the speed
    })
    */
    
    var CONST = {
    		OBJ:{
    			COPY_SPD: 800
    		},
    		EDEN : {
    			MAX_SIZE : 20,
    			LOC_RATE : 500,
    			MARK_RATE : 600
    		},
    		SUV : {
    			MAX_SIZE : 8,
    			MARK_RATE : 600
    		},
    		OLD : {
    			MAX_SIZE : 40,
    			MARK_RATE : 400,
    			DEL_RATE : 400
    		}
    	};
    
    function initializeHeapLayout(exceptTargets){
    	for (var inx = 0; inx < timeoutList.length; inx++) {
    	    clearTimeout(timeoutList[inx]);
    	}
    	timeoutList = [];
    	
    	var _exceptTargets = exceptTargets || {};
    	if( _exceptTargets["eden-allocate"]){
    	}else{
    		$("#eden-allocate .heap").remove();
        	$("#eden-allocate .figure").append($("#initial-heap .heap").clone());    		
    	}
    	
    	if( _exceptTargets["minor-gc-01"]){
    	}else{
    		$("#minor-gc-01 .heap").remove();
        	$("#minor-gc-01 .figure").append($("#initial-heap .heap").clone());
        	$("#minor-gc-01 .eden .object").removeClass("empty");	
    	}
    	
    	if( _exceptTargets["minor-gc-02"]){
    	}else{
    		$("#minor-gc-02 .heap").remove();
    		$("#minor-gc-02 .figure").append($("#initial-heap .heap").clone());
    		$("#minor-gc-02 .eden .object").removeClass("empty");
    		$("#minor-gc-02 .s1 .object").removeClass("empty");
    	}
    	
    	if( _exceptTargets["minor-gc-03"]){
    	}else{
    		$("#minor-gc-03 .heap").remove();
    		$("#minor-gc-03 .figure").append($("#initial-heap .heap").clone());
    		$("#minor-gc-03 .eden .object").removeClass("empty");
    		$("#minor-gc-03 .s2 .object").removeClass("empty");
    	}
    	
    	if( _exceptTargets["minor-gc-04"]){
    	}else{
    		$("#minor-gc-04 .heap").remove();
    		$("#minor-gc-04 .figure").append($("#initial-heap .heap").clone());
    		$("#minor-gc-04 .eden .object").removeClass("empty");
    		$("#minor-gc-04 .s1 .object").removeClass("empty");
    	}
    	
    	if( _exceptTargets["full-gc"]){
    	}else{
    		$("#full-gc .heap").remove();
    		$("#full-gc .figure").append($("#initial-heap .heap").clone());
    		$("#full-gc .eden .object").removeClass("empty");
    		$("#full-gc .s2 .object").removeClass("empty");
    		$("#full-gc .old .object").removeClass("empty");
    	}
    	
    	if( _exceptTargets["minor-gc-05"]){
    	}else{
    		$("#minor-gc-05 .heap").remove();
    		$("#minor-gc-05 .figure").append($("#initial-heap .heap").clone());
    		$("#minor-gc-05 .eden .object").removeClass("empty");
    		$("#minor-gc-05 .s1 .object").removeClass("empty");
    		$("#minor-gc-05 .old .object").slice(0,5).removeClass("empty");
    	}
    };
    
    function edenAllocate(){
    	var locNum = 1;
    	var allocateFnc = function(allocateObjNum, currentAllocatePos, timeout ){
    		var _tf = setTimeout(function(){
    			$("#eden-allocate .eden .object").slice(currentAllocatePos, allocateObjNum + currentAllocatePos).fadeIn("slow");            			
    		},timeout);
    		timeoutList.push(_tf);
		}
    	var currentAllocatePos = 0;
    	while( currentAllocatePos < CONST.EDEN.MAX_SIZE ){
    		var allocateObjNum = getRandomInt(1,3);
    		allocateFnc(allocateObjNum, currentAllocatePos,CONST.EDEN.LOC_RATE*locNum++);
    		currentAllocatePos += allocateObjNum;
    	}
    };
    
    function minorGC01(){
    	markNotuse("eden", minorGC_allocateEdenToS1);
    };
    
    function minorGC02(){
    	markNotuse("eden", minorGC_allocateEdenToS2);
    	markNotuse("s1", minorGC_allocateS1ToS2);
    };
    
    function minorGC03(){
    	markNotuse("eden", minorGC_allocateEdenToS1);
    	markNotuse("s2", minorGC_allocateS2ToS1);
    };
    
    function minorGC04(){
    	markNotuse("eden", minorGC_allocateEdenToS2);
    	markNotuse("s1", minorGC_allocateS1ToS2Old);
    };
    
    function fullGC(){
    	markNotuse("old",fullGC_compactAndSweep)
    };
    
    function minorGC05(){
    	markNotuse("eden", minorGC_allocateEdenToS2);
    	markNotuse("s1", minorGC_allocateS1ToS2Old);
    };
    
   	var timeoutList = [];
    function markNotuse(target, callback){
    	var maxSize = target == 'eden'?CONST.EDEN.MAX_SIZE:(target=='old'?CONST.OLD.MAX_SIZE:CONST.SUV.MAX_SIZE);
    	var markRate = target == 'eden'?CONST.EDEN.MARK_RATE:(target=='old'?CONST.OLD.MARK_RATE:CONST.SUV.MARK_RATE);
    	var survivoredObjNum = target=='old'?getRandomInt(10,20):getRandomInt(2,4);
    	var survivoredObjPosArr = [];
    	var curSurvivoredObjNum = 0;
    	while( curSurvivoredObjNum < survivoredObjNum ){
    		var randPos = getRandomInt(1,maxSize);
    		var dupRandPos = false;
    		for( var inx = 0 ; inx < survivoredObjPosArr.length;inx++ ){
    			dupRandPos = Number(survivoredObjPosArr[inx]) == randPos; 
    		}
    		if( !dupRandPos ){
    			curSurvivoredObjNum++;
    			survivoredObjPosArr.push(randPos);
    		}
    	}
    	
    	var markNotUseFnc = function(befSurvivoredObjPos, survivoredObjPos, timeout, callbackFnc, posArr){
    		var _tf=setTimeout(function(){
    			$(".carousel-inner .item.active ." + target + " .object").slice(befSurvivoredObjPos, survivoredObjPos).addClass("notuse");
    			if( callbackFnc ) callbackFnc.call(null, posArr);	
    		},timeout);
    		timeoutList.push(_tf);
    	};
    	survivoredObjPosArr.sort(function(a, b){return a-b});
    	
    	var befSurvivoredObjPos = 0;
    	for(var inx = 0 ; inx < survivoredObjPosArr.length ; inx++ ){
    		markNotUseFnc(befSurvivoredObjPos, Number(survivoredObjPosArr[inx]-1), markRate*inx);
    		$(".carousel-inner .item.active ." + target + " .object:eq(" + (survivoredObjPosArr[inx]-1) + ")").addClass("use");
    		befSurvivoredObjPos = Number(survivoredObjPosArr[inx]);
    	}
    	markNotUseFnc(befSurvivoredObjPos,maxSize,markRate*survivoredObjPosArr.length,callback,survivoredObjPosArr );
    };
    
    function copyObjects(src, trg, posArr){
    	var startingPos = getStartingOffset();
    	
    	var movingPosToArr = [];
    	$(".carousel-inner .item.active ." + trg + " .object.empty:not(.copying)").slice(0, posArr.length).removeClass("empty").addClass("copying _" + src );
    	$(".carousel-inner .item.active ." + trg + " .object.copying._" + src).each(function(){
    		movingPosToArr.push({left:$(this).offset().left-startingPos.left,top:$(this).offset().top-startingPos.top});
    	});

    	var movingPosToArrIdx = 0;
    	$(".carousel-inner .item.active ." + src + " .object.use").addClass("copying");
    	$(".carousel-inner .item.active ." + src + " .object.use").each(function(){
    		if(movingPosToArrIdx > movingPosToArr.length - 1) return;
    		var position = $(this).offset();
    		var copyingObj = $(this).clone();
    		$(copyingObj).css("position","absolute").css("left",position.left-startingPos.left).css("top", position.top-startingPos.top).addClass("moving").appendTo($(".carousel-inner .item.active .heap"));
			$(copyingObj).animate({left:movingPosToArr[movingPosToArrIdx].left,top:movingPosToArr[movingPosToArrIdx++].top},CONST.OBJ.COPY_SPD);    		
    	});
    	var _tf = setTimeout(function(){
    		$(".carousel-inner .item.active ." + src + " .object").fadeOut("slow");
    	},CONST.OBJ.COPY_SPD);
    	timeoutList.push(_tf);
    };
    
    function minorGC_allocateEdenToS1(posArr){
    	copyObjects("eden", "s1", posArr);
    };
    
    function minorGC_allocateEdenToS2(posArr){
    	copyObjects("eden", "s2", posArr);
    };
    
    function minorGC_allocateS1ToS2(posArr){
    	copyObjects("s1", "s2", posArr);
    };
    
    function minorGC_allocateS2ToS1(posArr){
    	copyObjects("s2", "s1", posArr);
    };
    
    function minorGC_allocateS1ToS2Old(posArr){
    	if( posArr.length > 1 ){
    		copyObjects("s1", "s2", posArr.slice(0,1));
    		copyObjects("s1", "old", posArr.slice(1,posArr.length));
    	}else{
    		copyObjects("s1", "old", posArr);
    	}
    };
    
    function fullGC_compactAndSweep(posArr){
    	
    	var sweepFnc = function(sweepStartPos, sweepEndPos, timeout, del){
    		var _tf=setTimeout(function(){
    			if(del){
    				$(".carousel-inner .item.active .old .object").slice(sweepStartPos,sweepEndPos).fadeOut("slow");
    			}else{
    				$(".carousel-inner .item.active .old .object").slice(sweepStartPos,sweepEndPos).removeClass("notuse").addClass("copying");
    			}
    		},timeout);
    		timeoutList.push(_tf);
    	};
    	
    	var befPos = 0;
    	var posIdx = 0;
    	var delTimer = 1;
    	$(".carousel-inner .item.active .old .object").each(function(){
    		if($(this).hasClass("use")){
    			sweepFnc(befPos,posIdx,CONST.OLD.DEL_RATE*delTimer++);
    			befPos = posIdx+1;
    		}
    		posIdx++;
    	});
    	sweepFnc(befPos,posIdx,CONST.OLD.DEL_RATE*delTimer++);
    	
    	var befPos = 0;
    	var posIdx = 0;
    	$(".carousel-inner .item.active .old .object").each(function(){
    		if($(this).hasClass("use")){
    			sweepFnc(befPos,posIdx,CONST.OLD.DEL_RATE*delTimer++,true);
    			befPos = posIdx+1;
    		}
    		posIdx++;
    	});
    	sweepFnc(befPos,posIdx,CONST.OLD.DEL_RATE*delTimer++,true);
    };
    
    
    function getStartingOffset(){
    	var _offset = $(".carousel-inner .item.active .heap").offset();
    	return {left:Number(_offset.left)-10, top: Number(_offset.top)+5};
    };
    
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    };
    </script>
</body>


</html>
